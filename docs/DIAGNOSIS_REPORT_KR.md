# SNES ì—ë®¬ë ˆì´í„° ë¬¸ì œ ì§„ë‹¨ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-10-23  
**ìƒíƒœ**: ğŸ”´ ì‹¬ê°í•œ ë¬¸ì œ ë°œê²¬

---

## ğŸš¨ í˜„ì¬ ì¦ìƒ

1. **í™”ë©´**: ê²€ì€ìƒ‰ í™”ë©´ë§Œ í‘œì‹œë¨
2. **ì†Œë¦¬**: ì‚¬ì¸íŒŒ ì¡ìŒë§Œ ë“¤ë¦¼
3. **ì°½ ì‘ë‹µ**: ì°½ì„ ì›€ì§ì¼ ìˆ˜ ì—†ìŒ (ì‘ë‹µ ì—†ìŒ)
4. **CPU**: ë¬´í•œ ë£¨í”„ì— ë¹ ì ¸ ìˆìŒ (NMI ë²¡í„° ê³„ì† ì½ìŒ)

---

## ğŸ” ë°œê²¬ëœ ì£¼ìš” ë¬¸ì œë“¤

### âŒ ë¬¸ì œ 1: CPU ë¦¬ì…‹ ë¡œì§ ì˜¤ë¥˜

**ìœ„ì¹˜**: `src/cpu/cpu.cpp:30-48`

**í˜„ì¬ ì½”ë“œ**:
```cpp
void CPU::reset() {
    uint16_t resetVector = m_memory->read16(0xFFFC);
    m_pc = 0x8000 | resetVector;  // âŒ ì˜ëª»ëœ ë¡œì§!
    //...
}
```

**ë¬¸ì œì **:
- `0x8000 | resetVector`ëŠ” ì˜ëª»ëœ ì—°ì‚°ì…ë‹ˆë‹¤
- ì˜ˆ: resetVectorê°€ 0x8000ì´ë©´ `0x8000 | 0x8000 = 0x8000` (ì •ìƒ)
- ì˜ˆ: resetVectorê°€ 0x0000ì´ë©´ `0x8000 | 0x0000 = 0x8000` (ë¬¸ì œ!)
- ë¦¬ì…‹ ë²¡í„° ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤

**í•´ê²° ë°©ë²•**:
```cpp
m_pc = resetVector;  // ë²¡í„° ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

---

### âŒ ë¬¸ì œ 2: BRK í•¸ë“¤ëŸ¬ ì˜¤ë¥˜

**ìœ„ì¹˜**: `src/cpu/cpu.cpp:1787-1798`

**í˜„ì¬ ì½”ë“œ**:
```cpp
case 0x00: { // BRK
    m_pc++;
    // Push PC and P
    //...
    m_pc = m_memory->read16(0xFFEE); // BRK ë²¡í„°
} break;
```

**ë¬¸ì œì **:
- BRK ë²¡í„°ê°€ 0xFFEEì¸ë°, SNESëŠ” 0xFFE6ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
- Emulation ëª¨ë“œ: 0xFFFE-0xFFFF
- Native ëª¨ë“œ: 0xFFE6-0xFFE7

**í•´ê²° ë°©ë²•**:
```cpp
uint16_t vectorAddr = m_emulationMode ? 0xFFFE : 0xFFE6;
m_pc = m_memory->read16(vectorAddr);
```

---

### âŒ ë¬¸ì œ 3: ë©”ì¸ ë£¨í”„ ë¸”ë¡œí‚¹

**ìœ„ì¹˜**: `src/main_complete.cpp:96-103`

**í˜„ì¬ ì½”ë“œ**:
```cpp
for (int scanline = 0; scanline < PPU::SCREEN_HEIGHT + 30; ++scanline) {
    for (int dot = 0; dot < 341; ++dot) {
        cpu.step();  // CPUê°€ ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ë©´ ì—¬ê¸°ì„œ ë©ˆì¶¤!
        ppu.step();
        apu.step();
    }
}
```

**ë¬¸ì œì **:
- CPUê°€ ë¬´í•œ ë£¨í”„(ë˜ëŠ” ê¸´ ë£¨í”„)ì— ë¹ ì§€ë©´ SDL ì´ë²¤íŠ¸ê°€ ì²˜ë¦¬ë˜ì§€ ì•ŠìŒ
- ì°½ì´ ì‘ë‹µí•˜ì§€ ì•Šê²Œ ë¨
- ì‚¬ì´í´ ì œí•œì´ ì—†ìŒ

**í•´ê²° ë°©ë²•**:
- ë§¤ í”„ë ˆì„ë‹¹ ìµœëŒ€ ì‚¬ì´í´ ìˆ˜ ì œí•œ
- ì •ê¸°ì ìœ¼ë¡œ SDL ì´ë²¤íŠ¸ ì²˜ë¦¬
- CPU ì‹¤í–‰ì„ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì œí•œ

---

### âš ï¸ ë¬¸ì œ 4: PPU ê°•ì œ ë¸”ë­í¬

**ìœ„ì¹˜**: `src/ppu/ppu.cpp:285-291`

**í˜„ì¬ ì½”ë“œ**:
```cpp
void PPU::renderScanline() {
    if (m_forcedBlank) {
        // ê²€ì€ í™”ë©´ ë Œë”ë§
        for (int x = 0; x < SCREEN_WIDTH; x++) {
            m_framebuffer[m_scanline * SCREEN_WIDTH + x] = 0x000000FF;
        }
        return;
    }
    //...
}
```

**ë¬¸ì œì **:
- `m_forcedBlank`ê°€ ì´ˆê¸°ê°’ `false`ì´ì§€ë§Œ, ê²Œì„ì´ ì„¤ì •í•  ìˆ˜ ìˆìŒ
- ê²Œì„ì´ ì‹œì‘ ì‹œ ê°•ì œ ë¸”ë­í¬ë¥¼ ì¼¤ ìˆ˜ ìˆìŒ
- ê·¸ë˜í”½ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ íŒ¨í„´ì„ ë³´ì—¬ì¤˜ì•¼ í•˜ëŠ”ë° ì•ˆ ë³´ì„

---

### âš ï¸ ë¬¸ì œ 5: APU ì˜¤ë””ì˜¤ ë…¸ì´ì¦ˆ

**ìœ„ì¹˜**: `src/apu/apu.cpp` (ì „ì²´)

**ë¬¸ì œì **:
- SPC700 ì´ˆê¸°í™”ê°€ ì œëŒ€ë¡œ ì•ˆ ë¨
- BRR ë””ì½”ë”©ì´ ë¹ˆ ë°ì´í„°ë¥¼ ìƒì„±
- ì‚¬ì¸íŒŒ ì¡ìŒì€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ì˜¤ë””ì˜¤ ë²„í¼

---

### âš ï¸ ë¬¸ì œ 6: NMI ë²¡í„° ë¬´í•œ ì½ê¸°

**ë¡œê·¸ ì¶œë ¥**:
```
Memory::read8(0xffea) -> ROM[0x7fea] = 0x38
Memory::read8(0xffeb) -> ROM[0x7feb] = 0xb1
(ê³„ì† ë°˜ë³µ...)
```

**ì˜ë¯¸**:
- NMI ë²¡í„°ê°€ 0xB138ì„ ê°€ë¦¬í‚´
- CPUê°€ ê³„ì† NMI ë²¡í„°ë¥¼ ì½ê³  ìˆìŒ
- 0xB138ì— ìˆëŠ” ì½”ë“œê°€ ë‹¤ì‹œ NMIë¥¼ íŠ¸ë¦¬ê±°í•˜ê±°ë‚˜ ë¬´í•œ ë£¨í”„

**ì›ì¸**:
1. CPUê°€ 0x0000 (BRK)ì—ì„œ ì‹œì‘
2. BRKê°€ ì˜ëª»ëœ ë²¡í„°ë¡œ ì í”„
3. í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ë‹¤ì‹œ NMI íŠ¸ë¦¬ê±°
4. ë¬´í•œ ë£¨í”„

---

## ğŸ“‹ ê°œë°œ ìš°ì„ ìˆœìœ„

### ğŸ”¥ ê¸´ê¸‰ (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)

#### 1. CPU ë¦¬ì…‹ ìˆ˜ì •
```cpp
// src/cpu/cpu.cpp
void CPU::reset() {
    uint16_t resetVector = m_memory->read16(0xFFFC);
    m_pc = resetVector;  // âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
    m_pbr = 0x00;  // Program BankëŠ” 0
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
}
```

#### 2. BRK/NMI ë²¡í„° ìˆ˜ì •
```cpp
// BRK ë²¡í„°
case 0x00: { // BRK
    m_pc++;
    // Push PC, PBR, P
    m_memory->write8(0x0100 + m_sp--, m_pbr);
    m_memory->write8(0x0100 + m_sp--, (m_pc >> 8) & 0xFF);
    m_memory->write8(0x0100 + m_sp--, m_pc & 0xFF);
    m_memory->write8(0x0100 + m_sp--, m_p | 0x10); // B flag
    m_p |= 0x04; // Set I flag
    m_pbr = 0x00;
    uint16_t vectorAddr = m_emulationMode ? 0xFFFE : 0xFFE6;
    m_pc = m_memory->read16(vectorAddr);
} break;

// NMI ë²¡í„°
void CPU::handleNMI() {
    // Push PBR, PC, P
    m_memory->write8(0x0100 + m_sp--, m_pbr);
    m_memory->write8(0x0100 + m_sp--, (m_pc >> 8) & 0xFF);
    m_memory->write8(0x0100 + m_sp--, m_pc & 0xFF);
    m_memory->write8(0x0100 + m_sp--, m_p);
    m_p |= 0x04; // Set I flag
    m_pbr = 0x00;
    uint16_t vectorAddr = m_emulationMode ? 0xFFFA : 0xFFEA;
    m_pc = m_memory->read16(vectorAddr);
}
```

#### 3. ë©”ì¸ ë£¨í”„ ì‚¬ì´í´ ì œí•œ
```cpp
// src/main_debug.cpp (ì´ë¯¸ ìƒì„±ë¨)
const int MAX_CYCLES_PER_FRAME = 89342;
int cyclesThisFrame = 0;

for (int scanline = 0; scanline < 262; ++scanline) {
    for (int dot = 0; dot < 341; ++dot) {
        if (cyclesThisFrame >= MAX_CYCLES_PER_FRAME) {
            break;  // ì‚¬ì´í´ ì œí•œ ë„ë‹¬
        }
        cpu.step();
        ppu.step();
        apu.step();
        cyclesThisFrame++;
    }
}
```

---

### ğŸŸ¡ ì¤‘ìš” (ë‹¤ìŒ ë‹¨ê³„)

#### 4. PPU í…ŒìŠ¤íŠ¸ íŒ¨í„´ ê°•ì œ í‘œì‹œ
```cpp
// src/ppu/ppu.cpp
void PPU::renderScanline() {
    // í•­ìƒ í…ŒìŠ¤íŠ¸ íŒ¨í„´ í‘œì‹œ (ë””ë²„ê¹…ìš©)
    for (int x = 0; x < SCREEN_WIDTH; x++) {
        uint32_t pixelColor;
        
        // ì²´í¬ë³´ë“œ íŒ¨í„´
        if ((x / 32 + m_scanline / 32) % 2 == 0) {
            pixelColor = 0xFF0000FF; // ë¹¨ê°•
        } else {
            pixelColor = 0x00FF00FF; // ì´ˆë¡
        }
        
        m_framebuffer[m_scanline * SCREEN_WIDTH + x] = pixelColor;
    }
}
```

#### 5. APU ë¬´ìŒ ì¶œë ¥
```cpp
// src/apu/apu.cpp
// ì¼ì‹œì ìœ¼ë¡œ APUë¥¼ ë¹„í™œì„±í™”í•˜ê³  ë¬´ìŒ ì¶œë ¥
void APU::audioCallback(void* userdata, uint8_t* stream, int len) {
    memset(stream, 0, len);  // ë¬´ìŒ
}
```

---

### ğŸŸ¢ ê°œì„  (ë‚˜ì¤‘ì—)

6. ROM í—¤ë” íŒŒì‹± (LoROM/HiROM ìë™ ê°ì§€)
7. DMA ì™„ì „ êµ¬í˜„
8. PPU ëª¨ë“  ë°°ê²½ ëª¨ë“œ êµ¬í˜„
9. ìŠ¤í”„ë¼ì´íŠ¸ ìš°ì„ ìˆœìœ„ ë° íˆ¬ëª…ë„
10. SPC700 ì™„ì „ êµ¬í˜„

---

## ğŸ› ï¸ ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ì„ì‹œ í•´ê²°ì±…

### ë¹ ë¥¸ ìˆ˜ì • 1: Debug ë¹Œë“œ ì‚¬ìš©

```bash
.\build_debug.bat
.\snes_emu_debug.exe
```

ì´ ë²„ì „ì€:
- ì‚¬ì´í´ ì œí•œ ìˆìŒ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
- ì •ê¸°ì ì¸ SDL ì´ë²¤íŠ¸ ì²˜ë¦¬
- FPS í‘œì‹œ ë° PC ì£¼ì†Œ ì¶œë ¥

### ë¹ ë¥¸ ìˆ˜ì • 2: í…ŒìŠ¤íŠ¸ íŒ¨í„´ í™œì„±í™”

PPUë¥¼ ìˆ˜ì •í•˜ì—¬ í•­ìƒ í…ŒìŠ¤íŠ¸ íŒ¨í„´ì„ í‘œì‹œí•˜ë„ë¡ í•©ë‹ˆë‹¤.

### ë¹ ë¥¸ ìˆ˜ì • 3: APU ë¹„í™œì„±í™”

ì„ì‹œë¡œ APU ì´ˆê¸°í™”ë¥¼ ê±´ë„ˆë›°ì–´ ì¡ìŒì„ ì œê±°í•©ë‹ˆë‹¤.

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### ìˆ˜ì • ì „
- âŒ ê²€ì€ í™”ë©´
- âŒ ì‚¬ì¸íŒŒ ì¡ìŒ
- âŒ ì°½ ì‘ë‹µ ì—†ìŒ
- âŒ CPU ë¬´í•œ ë£¨í”„

### ìˆ˜ì • í›„
- âœ… ì²´í¬ë³´ë“œ í…ŒìŠ¤íŠ¸ íŒ¨í„´ í‘œì‹œ
- âœ… ë¬´ìŒ (ë˜ëŠ” ì •ìƒ ì˜¤ë””ì˜¤)
- âœ… ì°½ ì •ìƒ ì‘ë‹µ
- âœ… CPU ì •ìƒ ì‹¤í–‰

---

## ğŸ¯ ë‹¨ê³„ë³„ ìˆ˜ì • ê³„íš

### 1ë‹¨ê³„: CPU ë¦¬ì…‹ ìˆ˜ì • (10ë¶„)
- `cpu.cpp`ì˜ `reset()` í•¨ìˆ˜ ìˆ˜ì •
- BRK/NMI ë²¡í„° ì£¼ì†Œ ìˆ˜ì •
- í…ŒìŠ¤íŠ¸

### 2ë‹¨ê³„: ë©”ì¸ ë£¨í”„ ìˆ˜ì • (10ë¶„)
- ì‚¬ì´í´ ì œí•œ ì¶”ê°€
- SDL ì´ë²¤íŠ¸ ì •ê¸° ì²˜ë¦¬
- í…ŒìŠ¤íŠ¸

### 3ë‹¨ê³„: PPU í…ŒìŠ¤íŠ¸ íŒ¨í„´ (5ë¶„)
- ê°•ì œë¡œ ì²´í¬ë³´ë“œ íŒ¨í„´ í‘œì‹œ
- í”„ë ˆì„ë²„í¼ í™•ì¸
- í…ŒìŠ¤íŠ¸

### 4ë‹¨ê³„: APU ì„ì‹œ ë¹„í™œì„±í™” (5ë¶„)
- ë¬´ìŒ ì¶œë ¥ìœ¼ë¡œ ë³€ê²½
- ì¡ìŒ ì œê±° í™•ì¸
- í…ŒìŠ¤íŠ¸

### 5ë‹¨ê³„: í†µí•© í…ŒìŠ¤íŠ¸ (10ë¶„)
- ëª¨ë“  ìˆ˜ì •ì‚¬í•­ ì ìš©
- ì „ì²´ í…ŒìŠ¤íŠ¸
- ë¬¸ì„œí™”

**ì˜ˆìƒ ì´ ì‹œê°„**: 40ë¶„

---

## ğŸ’¡ ê²°ë¡ 

í˜„ì¬ ì—ë®¬ë ˆì´í„°ì˜ ì£¼ìš” ë¬¸ì œëŠ” **CPU ì´ˆê¸°í™” ë° ë²¡í„° ì²˜ë¦¬ ì˜¤ë¥˜**ì…ë‹ˆë‹¤. ì´ë¡œ ì¸í•´:

1. CPUê°€ ì˜¬ë°”ë¥¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ëª»í•¨
2. ë¬´í•œ ë£¨í”„ì— ë¹ ì§
3. SDL ì´ë²¤íŠ¸ ë£¨í”„ê°€ ë¸”ë¡œí‚¹ë¨
4. í™”ë©´ì´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**: CPU ë¦¬ì…‹ ë¡œì§ê³¼ ì¸í„°ëŸ½íŠ¸ ë²¡í„°ë¥¼ ìˆ˜ì •í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œê°€ í•´ê²°ë  ê²ƒì…ë‹ˆë‹¤.

---

**ì‘ì„±ì**: AI ê°œë°œ ì—ì´ì „íŠ¸  
**ìš°ì„ ìˆœìœ„**: ğŸ”¥ ê¸´ê¸‰  
**ë‹¤ìŒ ì‘ì—…**: CPU ë¦¬ì…‹ ë° ë²¡í„° ìˆ˜ì •



